

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Conveyor Belt Thermodynamic Integration with Ensembler &mdash; Ensembler beta documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="EDS Simulation" href="Example_EDS.html" />
    <link rel="prev" title="Examples" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Ensembler
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Welcome to Ensembler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Conveyor Belt Thermodynamic Integration with Ensembler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Loading-Ensembler-and-necessary-external-packages">Loading Ensembler and necessary external packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Interactive-Example">Interactive Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Build-a-conveyor-belt-object">Build a conveyor belt object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Start-a-conveyor-belt-simulation">Start a conveyor belt simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Visualizations-of-the-trajectories">Visualizations of the trajectories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Simple-analysis-of-the-conveyor-belt-simulation">Simple analysis of the conveyor belt simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Example_EDS.html">EDS Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_EnhancedSampling.html">Enhanced Sampling Simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example_FreeEnergyCalculationSimulation.html">Free Energy Calculations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_source/modules.html">Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ensembler</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Examples</a> &raquo;</li>
        
      <li>Conveyor Belt Thermodynamic Integration with Ensembler</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Examples/Example_ConveyorBelt.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Conveyor-Belt-Thermodynamic-Integration-with-Ensembler">
<h1>Conveyor Belt Thermodynamic Integration with Ensembler<a class="headerlink" href="#Conveyor-Belt-Thermodynamic-Integration-with-Ensembler" title="Permalink to this headline">¶</a></h1>
<p>In this notebook, we give examples how to run conveyor belt simulations with Ensembler.</p>
<p>Maintainers: [&#64;SchroederB](<a class="reference external" href="https://https://github.com/SchroederB">https://https://github.com/SchroederB</a>), [&#64;linkerst](<a class="reference external" href="https://https://github.com/linkerst">https://https://github.com/linkerst</a>), [&#64;dfhahn](<a class="reference external" href="https://https://github.com/dfhahn">https://https://github.com/dfhahn</a>)</p>
<div class="section" id="Loading-Ensembler-and-necessary-external-packages">
<h2>Loading Ensembler and necessary external packages<a class="headerlink" href="#Loading-Ensembler-and-necessary-external-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;/..&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colorbar</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="kn">import</span> <span class="nn">ensembler.potentials.OneD</span> <span class="k">as</span> <span class="nn">pot</span>
<span class="kn">import</span> <span class="nn">ensembler.system.perturbed_system</span> <span class="k">as</span> <span class="nn">system</span>
<span class="kn">import</span> <span class="nn">ensembler.ensemble.replicas_dynamic_parameters</span> <span class="k">as</span> <span class="nn">cvb</span>
<span class="kn">from</span> <span class="nn">ensembler.samplers</span> <span class="kn">import</span> <span class="n">stochastic</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Interactive-Example">
<h2>Interactive Example<a class="headerlink" href="#Interactive-Example" title="Permalink to this headline">¶</a></h2>
<p>The following is an interactive example, which explains the concept of the conveyor belt algorithm</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ensembler.visualisation.interactive_plots</span> <span class="kn">import</span> <span class="n">interactive_conveyor_belt</span>

<span class="n">iwidget</span> <span class="o">=</span> <span class="n">interactive_conveyor_belt</span><span class="p">()</span>
<span class="n">iwidget</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "fb4905137bc543789a3e0d02640bd354", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="Build-a-conveyor-belt-object">
<h2>Build a conveyor belt object<a class="headerlink" href="#Build-a-conveyor-belt-object" title="Permalink to this headline">¶</a></h2>
<p>For building a <code class="docutils literal notranslate"><span class="pre">conveyorBelt</span></code> object, you first have to build a <code class="docutils literal notranslate"><span class="pre">system</span></code>, which will be used as a template for the replicas. The <code class="docutils literal notranslate"><span class="pre">system</span></code> itself needs to to be initialized with a potential and an integrator. For details, see the Tutorial Simulations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">stochastic</span><span class="o">.</span><span class="n">metropolisMonteCarloIntegrator</span><span class="p">()</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">linearCoupledPotentials</span><span class="p">(</span><span class="n">Va</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
    <span class="n">Vb</span> <span class="o">=</span> <span class="n">pot</span><span class="o">.</span><span class="n">harmonicOscillatorPotential</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="mf">2.0</span><span class="p">))</span>
<span class="n">sys</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">perturbedSystem</span><span class="p">(</span><span class="n">potential</span><span class="o">=</span><span class="n">potential</span> <span class="p">,</span>
                              <span class="n">sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Additional the number of replicas <code class="docutils literal notranslate"><span class="pre">n_replicas</span></code> and the initial capital Lambda value needs to be specified. The latter can usually be set to 0. An additional (optional) argument is the <code class="docutils literal notranslate"><span class="pre">build</span></code> variable, which will be discussed later.</p>
<p>The output shows the current state of the conveyor belt as a table with the replica ID, the corresponding lambda value and the energy of the replica.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ensemble</span> <span class="o">=</span> <span class="n">cvb</span><span class="o">.</span><span class="n">conveyorBelt</span><span class="p">(</span><span class="n">capital_lambda</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                            <span class="n">n_replicas</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                            <span class="n">system</span><span class="o">=</span><span class="n">sys</span><span class="p">)</span>
<span class="n">ensemble</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
i    lambda_i  E_i
-------------------------
    0      0.00    32.975
    1      0.50    32.975
    2      1.00    32.975
    3      0.50    32.975
</pre></div></div>
</div>
</div>
<div class="section" id="Start-a-conveyor-belt-simulation">
<h2>Start a conveyor belt simulation<a class="headerlink" href="#Start-a-conveyor-belt-simulation" title="Permalink to this headline">¶</a></h2>
<p>The conveyor belt is simulated by using its member function <code class="docutils literal notranslate"><span class="pre">simulate</span></code> with the number of steps as argument.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">steps</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "14271dff9b23471ca713a49a5e1d1540", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<p>The trajectories of the ensemble <code class="docutils literal notranslate"><span class="pre">cvb_traj</span></code> and the single systems <code class="docutils literal notranslate"><span class="pre">sys_trajs</span></code> can be retrieved by using its member function <code class="docutils literal notranslate"><span class="pre">get_trajs</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span><span class="n">cvb_traj</span><span class="p">,</span> <span class="n">systrajs</span><span class="p">)</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_trajs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The ensemble trajectory is a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object with the following columns: - <strong>Step</strong>: index of frame (starting from 1) - <strong>capital_lambda</strong>: the capital lambda of the frame - <strong>TotE</strong>: the current total energy of the ensemble - <strong>biasE</strong>: the current bias energy - <strong>doAccept</strong>: information whether the Monte Carlo step before the frame was accepted or not</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cvb_traj</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Step</th>
      <th>capital_lambda</th>
      <th>TotE</th>
      <th>biasE</th>
      <th>doAccept</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.000000</td>
      <td>131.899937</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>5.539295</td>
      <td>131.899937</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>5.249743</td>
      <td>80.759163</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>5.748955</td>
      <td>41.452370</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>6.149164</td>
      <td>26.454378</td>
      <td>0.0</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The system trajectory object <code class="docutils literal notranslate"><span class="pre">systrajs</span></code> is a <code class="docutils literal notranslate"><span class="pre">list</span></code> of <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> objects (one per replica) with the following columns: - <strong>position</strong>: (spatial) position of particle - <strong>temperature</strong>: temperature - <strong>total_system_energy</strong>: the current total energy of the replica - <strong>total_potential_energy</strong>: the current potential energy of the replica - <strong>total_kinetic_energy</strong>: the current kinetic energy of the replica - <strong>dhdpos</strong>: the derivative of the hamiltonian with repect to the position
(negative of the force) - <strong>velocity</strong>: velocity of the particle - <strong>lam</strong>: lambda value of the particle - <strong>dhdlam</strong>: Hamiltonian derivative with respect to lambda The kinetic energy and the velocity are <code class="docutils literal notranslate"><span class="pre">NaN</span></code> in the following, becauce this example uses the stochastic <code class="docutils literal notranslate"><span class="pre">metropolisMonteCarloIntegrator</span></code>, which does not calculate velocities.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">systrajs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>position</th>
      <th>temperature</th>
      <th>total_system_energy</th>
      <th>total_potential_energy</th>
      <th>total_kinetic_energy</th>
      <th>dhdpos</th>
      <th>velocity</th>
      <th>lam</th>
      <th>dhdlam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-3.478970704571898</td>
      <td>298.0</td>
      <td>11.726825</td>
      <td>11.726825</td>
      <td>NaN</td>
      <td>1.7510607172656856</td>
      <td>NaN</td>
      <td>0.236788</td>
      <td>23.967501</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.7551488977681826</td>
      <td>298.0</td>
      <td>0.701098</td>
      <td>0.701098</td>
      <td>NaN</td>
      <td>4.234119602340081</td>
      <td>NaN</td>
      <td>0.328955</td>
      <td>1.264529</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.44181625124460233</td>
      <td>298.0</td>
      <td>0.493877</td>
      <td>0.493877</td>
      <td>NaN</td>
      <td>-0.3133326465235803</td>
      <td>NaN</td>
      <td>0.170051</td>
      <td>2.330336</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.4361344163389951</td>
      <td>298.0</td>
      <td>0.344227</td>
      <td>0.344227</td>
      <td>NaN</td>
      <td>-0.8779506675835974</td>
      <td>NaN</td>
      <td>0.042660</td>
      <td>5.839644</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.2002660837131477</td>
      <td>298.0</td>
      <td>0.395400</td>
      <td>0.395400</td>
      <td>NaN</td>
      <td>0.6364005000521428</td>
      <td>NaN</td>
      <td>0.116604</td>
      <td>3.218989</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Visualizations-of-the-trajectories">
<h2>Visualizations of the trajectories<a class="headerlink" href="#Visualizations-of-the-trajectories" title="Permalink to this headline">¶</a></h2>
<p>The following graph shows exemplarious the trajectories and histograms of the lambda variables of the single replicas. Other of the above mentioned variables can be plottet in the same way.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">systrajs</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">systrajs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">systrajs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lam</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">h1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">systrajs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lam</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">h1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">h1</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">h1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;time step&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;probability density&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\lambda$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;$\lambda$ trajectories and histograms of the replicas&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=.</span><span class="mi">6</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Examples_Example_ConveyorBelt_19_0.png" src="../_images/Examples_Example_ConveyorBelt_19_0.png" />
</div>
</div>
</div>
<div class="section" id="Simple-analysis-of-the-conveyor-belt-simulation">
<h2>Simple analysis of the conveyor belt simulation<a class="headerlink" href="#Simple-analysis-of-the-conveyor-belt-simulation" title="Permalink to this headline">¶</a></h2>
<p>First, we simulate the conveyor belt even longer to get more statistics. Then, we sort the combined dhdlam trajectories from all replicas according to the associated lambda value. Then, we calculate the average per bin, which gives you the <code class="docutils literal notranslate"><span class="pre">&lt;dhdlam&gt;</span></code>(lam) estimate at point <code class="docutils literal notranslate"><span class="pre">lam</span></code>. In the following we use <code class="docutils literal notranslate"><span class="pre">nbins=100</span></code>, but you can adapt it according to your sampled data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ensemble</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mi">900</span><span class="p">)</span>
<span class="p">(</span><span class="n">cvb_traj</span><span class="p">,</span> <span class="n">systrajs</span><span class="p">)</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">get_trajs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b59d583a118140b1a46cced11c82c910", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nbins</span><span class="o">=</span><span class="mi">100</span>
<span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">dhdlbins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">systrajs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">systrajs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">systrajs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">nbins</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">nbins</span><span class="p">:</span>
            <span class="n">index</span><span class="o">=</span><span class="n">nbins</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">bins</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">dhdlbins</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">+=</span><span class="n">systrajs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dhdlam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="c1"># avoid division by zero by setting elements == 0 to 1</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">dhdlbins</span><span class="o">/=</span><span class="n">bins</span>
</pre></div>
</div>
</div>
<p>The plotted <code class="docutils literal notranslate"><span class="pre">&lt;dhdlam&gt;(lam)</span></code> curve is similar to the curves you get from TI simulations, but is usually base on more lambda points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nbins</span><span class="p">),</span> <span class="n">dhdlbins</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$\lambda$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\partial H / \partial \lambda$&quot;</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;$\partial H / \partial \lambda (\lambda)$ curve&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=.</span><span class="mi">6</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The integral of this curve gives the free energy estimate. As you have many points along <span class="math notranslate nohighlight">\(\lambda\)</span>, you can use the rectangular integration:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">integral</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dhdlbins</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">nbins</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Delta G = </span><span class="si">{</span><span class="n">integral</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> kJ/mol&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This value agrees well to the analytical value, which is calculated below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#analytical</span>
<span class="n">u</span><span class="o">=</span><span class="mf">1.66053886e-27</span>
<span class="n">NA</span><span class="o">=</span><span class="mf">6.0221415e23</span>
<span class="n">hbar</span><span class="o">=</span><span class="mf">1.054571800e-34</span><span class="o">*</span><span class="mf">1e12</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">*</span><span class="n">NA</span>  <span class="c1">#kJ/mol*ps</span>
<span class="n">R</span><span class="o">=</span><span class="mf">0.00831446</span> <span class="c1">#kJ/mol/K</span>
<span class="n">mu</span><span class="o">=</span><span class="mf">0.5</span>  <span class="c1">#u</span>
<span class="n">T</span><span class="o">=</span><span class="mf">298.0</span>  <span class="c1">#K</span>
<span class="n">fc1</span><span class="o">=</span><span class="mi">1</span>  <span class="c1">#kJ/nm^2/mol</span>
<span class="n">fc2</span><span class="o">=</span><span class="mf">2.0</span> <span class="c1">#kJ/nm^2/mol</span>
<span class="n">omega1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fc1</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span>
<span class="n">omega2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fc2</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span>
<span class="n">alpha1</span><span class="o">=</span><span class="n">hbar</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fc1</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">T</span><span class="p">)</span>
<span class="n">alpha2</span><span class="o">=</span><span class="n">hbar</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fc2</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">T</span><span class="p">)</span>
<span class="n">Z1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha1</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha1</span><span class="p">))</span>
<span class="n">Z2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha2</span><span class="p">))</span>
<span class="n">DF</span><span class="o">=-</span><span class="n">R</span><span class="o">*</span><span class="n">T</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Z2</span><span class="o">/</span><span class="n">Z1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Analytical value = </span><span class="si">{</span><span class="n">DF</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> kJ/mol&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Example_EDS.html" class="btn btn-neutral float-right" title="EDS Simulation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Benjamin Ries, Stephanie Linker, David Hahn. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.3

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>